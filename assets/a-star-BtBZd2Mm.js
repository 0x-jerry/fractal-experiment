var E=Object.defineProperty;var x=(l,e,t)=>e in l?E(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var c=(l,e,t)=>(x(l,typeof e!="symbol"?e+"":e,t),t);import{u as v,a as k,_ as I}from"./useCanvasRunner-BtSyTrXL.js";import{G as P}from"./grid-BnBmgwES.js";import"./vec2-ikhXc4Ii.js";import{d as C,o as A,c as W,w as R,a as z,u as M}from"./index-B1bq4_oz.js";class N{constructor(e){c(this,"_toElementFn");if(e){const{toElementFn:t}=e;if(typeof t=="function")this._toElementFn=t;else if(t)throw new TypeError("toElementFn must be a function type")}}get toElementFn(){return this._toElementFn}*[Symbol.iterator](...e){yield*this._getIterator(...e)}*values(){for(const e of this)yield e}every(e,t){let s=0;for(const r of this)if(!e.call(t,r,s++,this))return!1;return!0}some(e,t){let s=0;for(const r of this)if(e.call(t,r,s++,this))return!0;return!1}forEach(e,t){let s=0;for(const r of this)e.call(t,r,s++,this)}find(e,t){let s=0;for(const r of this)if(e.call(t,r,s++,this))return r}has(e){for(const t of this)if(t===e)return!0;return!1}reduce(e,t){let s=t,r=0;for(const n of this)s=e(s,n,r++,this);return s}print(){console.log([...this])}}/**
 * data-structure-typed
 * @author Kirk Qi
 * @copyright Copyright (c) 2022 Kirk Qi <qilinaus@gmail.com>
 * @license MIT License
 */class m extends N{constructor(t=[],s){super(s);c(this,"_elements",[]);c(this,"_DEFAULT_COMPARATOR",(t,s)=>{if(typeof t=="object"||typeof s=="object")throw TypeError("When comparing object types, a custom comparator must be defined in the constructor's options parameter.");return t>s?1:t<s?-1:0});c(this,"_comparator",this._DEFAULT_COMPARATOR);if(s){const{comparator:r}=s;r&&(this._comparator=r)}if(t)for(const r of t)this.toElementFn?this.add(this.toElementFn(r)):this.add(r)}get elements(){return this._elements}get size(){return this.elements.length}get leaf(){return this.elements[this.size-1]??void 0}static heapify(t,s){return new m(t,s)}add(t){return this._elements.push(t),this._bubbleUp(this.elements.length-1)}poll(){if(this.elements.length===0)return;const t=this.elements[0],s=this.elements.pop();return this.elements.length&&(this.elements[0]=s,this._sinkDown(0,this.elements.length>>1)),t}peek(){return this.elements[0]}isEmpty(){return this.size===0}clear(){this._elements=[]}refill(t){return this._elements=t,this.fix()}has(t){return this.elements.includes(t)}delete(t){const s=this.elements.indexOf(t);return s<0?!1:(s===0?this.poll():s===this.elements.length-1?this.elements.pop():(this.elements.splice(s,1,this.elements.pop()),this._bubbleUp(s),this._sinkDown(s,this.elements.length>>1)),!0)}dfs(t="PRE"){const s=[],r=n=>{const o=2*n+1,i=o+1;n<this.size&&(t==="IN"?(r(o),s.push(this.elements[n]),r(i)):t==="PRE"?(s.push(this.elements[n]),r(o),r(i)):t==="POST"&&(r(o),r(i),s.push(this.elements[n])))};return r(0),s}toArray(){return[...this.elements]}clone(){return new m(this,{comparator:this.comparator,toElementFn:this.toElementFn})}sort(){const t=[],s=new m(this,{comparator:this.comparator});for(;s.size!==0;){const r=s.poll();r!==void 0&&t.push(r)}return t}fix(){const t=[];for(let s=Math.floor(this.size/2);s>=0;s--)t.push(this._sinkDown(s,this.elements.length>>1));return t}filter(t,s){const r=new m([],{toElementFn:this.toElementFn,comparator:this.comparator});let n=0;for(const o of this)t.call(s,o,n,this)&&r.add(o),n++;return r}map(t,s,r,n){const o=new m([],{comparator:s,toElementFn:r});let i=0;for(const d of this)o.add(t.call(n,d,i,this)),i++;return o}get comparator(){return this._comparator}*_getIterator(){for(const t of this.elements)yield t}_bubbleUp(t){const s=this.elements[t];for(;t>0;){const r=t-1>>1,n=this.elements[r];if(this.comparator(n,s)<=0)break;this.elements[t]=n,t=r}return this.elements[t]=s,!0}_sinkDown(t,s){const r=this.elements[t];for(;t<s;){let n=t<<1|1;const o=n+1;let i=this.elements[n];if(o<this.elements.length&&this.comparator(i,this.elements[o])>0&&(n=o,i=this.elements[o]),this.comparator(i,r)>=0)break;this.elements[t]=i,t=n}return this.elements[t]=r,!0}}class g extends m{constructor(e=[],t){super(e,t)}clone(){return new g(this,{comparator:this.comparator,toElementFn:this.toElementFn})}filter(e,t){const s=new g([],{toElementFn:this.toElementFn,comparator:this.comparator});let r=0;for(const n of this)e.call(t,n,r,this)&&s.add(n),r++;return s}map(e,t,s,r){const n=new g([],{comparator:t,toElementFn:s});let o=0;for(const i of this)n.add(e.call(r,i,o,this)),o++;return n}}var S=(l=>(l[l.Walkable=1]="Walkable",l[l.NonWalkable=2]="NonWalkable",l))(S||{});class y{constructor(e,t){c(this,"data",new Map);this.gird=e,this.defaultValue=t}get(e){const t=this.gird.getIndex(e.x,e.y);return this.data.get(t)??this.defaultValue}set(e,t){const s=this.gird.getIndex(e.x,e.y);return this.data.set(s,t)}has(e){const t=this.gird.getIndex(e.x,e.y);return this.data.has(t)}delete(e){const t=this.gird.getIndex(e.x,e.y);this.data.delete(t)}clear(){this.data.clear()}}class O{constructor(e,t){c(this,"grid");c(this,"gScore");c(this,"fScore");c(this,"cameFrom");c(this,"openSet",new g);this.w=e,this.h=t,this.grid=new P(e,t),this.grid.forEach((s,r,n)=>{this.grid.set(r,n,1)}),this.gScore=new y(this.grid,1/0),this.fScore=new y(this.grid,1/0),this.cameFrom=new y(this.grid)}getAroundWalkableCells(e){const t=[];for(let s=e.y-1;s<=e.y+1;s++)for(let r=e.x-1;r<=e.x+1;r++){if(r===e.x&&s===e.y)continue;const n=this.grid.get(r,s);n!=null&&n&1&&t.push({x:r,y:s})}return t}getIndex(e){return this.grid.getIndex(e.x,e.y)}*resolve(e,t,s){for(this.fScore.clear(),this.gScore.clear(),this.cameFrom.clear(),this.openSet=new g([],{comparator:(r,n)=>{const o=this.fScore.get(r),i=this.fScore.get(n);return o-i}}),this.gScore.set(e,0),this.fScore.set(e,s.heuristic(e,t)),this.openSet.add(e);!this.openSet.isEmpty();){yield;const r=this.openSet.poll();if(this._rearch(r,t))return this._reconstructPath(r);const n=this.getAroundWalkableCells(r);for(const o of n){const i=this.gScore.get(r)+s.distance(r,o),d=this.gScore.get(o);i<d&&(this.cameFrom.set(o,r),this.gScore.set(o,i),this.fScore.set(o,i+s.heuristic(o,t)),this.openSet.has(o)||this.openSet.add(o))}}return[]}_rearch(e,t){return e.x===t.x&&e.y===t.y}_reconstructPath(e){const t=[];for(;this.cameFrom.has(e);){const s=this.cameFrom.get(e);t.push(s),e=s}return t}}function D(l,e){const{cellSize:t}=e,{width:s,height:r}=l.canvas,n=~~(s/t),o=~~(r/t),i=new O(n,o),d={x:1,y:1},_={x:n-1,y:o-1};for(let a=0;a<_.y-1;a++)i.grid.set(10,a,S.NonWalkable);for(let a=o/2;a<o;a++)i.grid.set(20,a,S.NonWalkable);return F();function*F(){const a=i.resolve(d,_,{heuristic(h,u){return Math.pow(h.x-u.x,2)+Math.pow(h.y-u.y,2)},distance(h,u){return Math.sqrt(Math.pow(h.x-u.x,2)+Math.pow(h.y-u.y,2))}});let w=a.next();const p=50;let f=p;for(yield;!w.done;)w=a.next(),f--<0&&(f=p,b(),yield);b()}function b(){const a={color:"#ffffff",visitedColor:"#3c85d2",obstacleColor:"#f26f6f",startColor:"#ff0000",endColor:"#ff0000",pathColor:"#00ff00"};i.grid.forEach((p,f,h)=>{i._rearch(d,{x:f,y:h})?l.fillStyle=a.startColor:i._rearch(_,{x:f,y:h})?l.fillStyle=a.endColor:i.cameFrom.has({x:f,y:h})?l.fillStyle=a.visitedColor:(p??0)&S.Walkable?l.fillStyle=a.color:l.fillStyle=a.obstacleColor,l.fillRect(f*t,h*t,t,t)});const w=i.openSet.peek();if(w){const p=i._reconstructPath(w);for(const f of p){const{x:h,y:u}=f;l.fillStyle=a.pathColor,l.fillRect(h*t,u*t,t,t)}}}}const j=C({__name:"a-star",setup(l){const e=v({cellSize:{_:"number",value:10,step:1,min:1,max:50},FPS:{_:"number",step:1,value:60,min:1,max:120}}),t=k(s=>{const r=e.value;return D(s,r)},{fps:()=>e.value.FPS});return(s,r)=>(A(),W(I,{title:"A Star"},{default:R(()=>[z("div",{ref:M(t).ctx.ref,class:"w-full h-full"},null,512)]),_:1}))}});export{j as default};
